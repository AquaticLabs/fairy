package org.fairy.gradle.file;

import org.apache.commons.lang3.tuple.Pair;
import org.fairy.gradle.FairyExtension;
import org.fairy.gradle.PlatformType;
import org.fairy.gradle.util.PropertyUtil;

import java.nio.charset.StandardCharsets;
import java.util.StringJoiner;

public class FileGeneratorBukkit implements FileGenerator {

    private static final String BOOTSTRAP_CLASS = ".bootstrap.bukkit.BukkitPlugin";

    @Override
    public Pair<String, byte[]> generate(FairyExtension extension, String mainClass) {
        StringJoiner stringJoiner = new StringJoiner("\n");

        stringJoiner.add("# Generated by Fairy");
        stringJoiner.add("name: " + extension.getName().get());
        stringJoiner.add("version: " + extension.getVersion().get());
        stringJoiner.add("main: " + extension.getShadedPackage().get() + BOOTSTRAP_CLASS);
        PropertyUtil.ifPresent(extension.getDescription(), description -> stringJoiner.add("description: " + description));
        extension.properties(PlatformType.BUKKIT).forEach((k, v) -> stringJoiner.add(k + ": " + v));

        return Pair.of("plugin.yml", stringJoiner.toString().getBytes(StandardCharsets.UTF_8));
    }
}
